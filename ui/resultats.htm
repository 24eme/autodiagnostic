<include href="header.htm">

<div id="resultats-title" class="mb-4">
  <div class="pt-5 pb-2">
    <div class="container-fluid text-center">
      <h1 class="text-center d-inline-block display-5 fw-bold"><a class="text-white" href=""><i class="bi-award"></i> Vos résultats</a></h1>
      <check if="{{ @engage }}">
        <h1 class="text-center opacity-25 d-inline-block display-5 fw-bold ms-5"><a class="text-white" href="{{ 'formules', '@file='.@file.',@md5='.@md5 | alias }}"><i class="bi bi-card-checklist"></i> Votre formule</a></h1>
      </check>
      <h2 class="fw-bold">
        <repeat group="{{ @tabOtherCampagne}}" key="{{ @key }}" value="{{ @value }}">
          <a class="
          <check if='{{ @key == @campagne }}'>
            <true></true>
            <false>opacity-25</false>
          </check>
            small text-white" href="{{ 'resultats', '@file='.pathinfo(basename(@value),PATHINFO_FILENAME).',@md5='.md5_file(@value) | alias }}">{{ @key }}<a>
            <i class="bi bi-dot text-white opacity-25 small"></i>
        </repeat>
    </div>
  </div>
</div>

<div id="resultats-presentation" class="container mb-5">
  <p class="lead">
    Vos réponses ont été analysées. Vos performances sont représentées en pourcentage dans le diagramme radar ci-dessous. Chaque axe reprend les différentes thématiques du questionnaire. Votre score est comparé à la moyenne des pratiques des opérateurs du Centre-Loire.
  </p>
  <p class="lead">
    Les points d'améliorations listent les pratiques que vous pouvez faire évoluer. Pour cela, des fiches techniques sont à votre disposition sur l'écran suivant.
  </p>
</div>

<div id="resultats-content" class="container mb-5">
  <div class="row mb-3">
    <div id="resultats-points-amelioration" class="col-sm-6">
      <h3 class="display-6 bg-success text-light"><i class="bi-sun"></i> Vos points forts</h3>
      <check if="{{ count(@statistiques->getPtsForts()) }}">
        <true>
          <repeat group="{{ @statistiques->getPtsForts() }}" value="{{ @ptFort }}">
            <div class="p-1 d-flex align-items-center">
              <i class="bi-check-circle-fill fs-3 text-success me-3"></i> {{ @ptFort }}
            </div>
          </repeat>
          <check if="{{ @statistiqueslastCampagne and count(@statistiques->getPtsForts()) > count(@statistiqueslastCampagne->getPtsForts()) }}">
            <true>
              <div class="p-1 d-flex align-items-center">
                <i class="bi-check-circle-fill fs-3 text-success me-3"></i>Vous avez plus de "points forts" par rapport à l'année précédente
              </div>
            </true>
          </check>
          <check if="{{ @statistiqueslastCampagne and count(@statistiques->getPtsAmeliorations()) < count(@statistiqueslastCampagne->getPtsAmeliorations()) }}">
            <true>
              <div class="p-1 d-flex align-items-center">
                <i class="bi-check-circle-fill fs-3 text-success me-3"></i>Vous avez moins de "points d'améliorations" par rapport à l'année précédente
              </div>
            </true>
          </check>
        </true>
        <false>
          <div class="p-1 d-flex align-items-center">
            <i class="bi bi-info-circle fs-3 me-3"></i> Des fiches sont à votre disposition pour améliorer vos pratiques
          </div>
        </false>
      </check>

      <h3 class="display-6 mt-4 bg-warning text-light"><i class="bi-cloud-sun"></i> Vos points d'améliorations</h3>
      <check if="{{ count(@statistiques->getPtsAmeliorations()) }}">
        <true>
          <repeat group="{{ @statistiques->getPtsAmeliorations() }}" value="{{ @ptAmelioration }}">
            <div class="p-1 d-flex align-items-center">
              <i class="bi bi-record-circle-fill fs-3 text-warning me-3"></i> {{ @ptAmelioration }}
            </div>
          </repeat>
        </true>
        <false>
          <div class="p-1 d-flex align-items-center">
            <i class="bi bi-info-circle fs-3 me-3"></i> Vos pratiques sont en accord avec notre charte environnementale
          </div>
        </false>
      </check>

    </div>

    <div id="resultats-graphs" class="col-sm-6 pagebreak">
      <h3 class="display-6 bg-app-blue text-light mb-5">Répartition des points par catégorie</h3>
      <canvas
        id="resultats-radar-chart"
        class="py-3"
        data-type="radar"
        data-labels="{{ @statistiques->renderTabKeysScores() }}"
        data-series="{{ @statistiques->renderTabValuesScores() }}"
        <check if="{{ @statistiqueslastCampagne}}">
          <true>data-lastCampagne="{{ @statistiqueslastCampagne->renderTabValuesScores() }}"</true>
          <false>data-lastCampagne=null</false>
        </check>
        data-moyenne="{{ implode(',', @statistiques->calculMoyenneVignoble()) }}">
      </canvas>
    </div>
  </div>
</div>

<check if="{{ @engage }}">
<false>
<div id="resultats-cta" class="container d-print-none">
  <div class="py-4 bg-light">
    <h3 class="display-5 text-center mb-5">Mon auto-évaluation</h3>
    <div class="d-grid justify-content-center px-3">
      <p>Le score de votre exploitation va vous permettre maintenant d’entrer dans l’une des formules de la charte Développement Durable Centre/Loire.</p>
      <p>Pour cela,</p>
      <ol>
        <li>Vous vous engagez à rechercher des pratiques toujours plus durables.</li>
        <li>Vous participez à la transition écologique de votre appellation.</li>
        <li>Vous autorisez l’utilisation de vos réponses à des fins statistiques internes. En aucun cas, elles ne seront utilisées individuellement. Vous avez la garantie qu’elles ne seront pas transmises à des tiers.</li>
      </ol>
      <div class="row g-3 m-auto text-center">
        <div class="col-auto">
          <form method="post" action="{{ 'engagement' | alias }}">
            <check if="{{ @auth->getAuthType() === Auth\Type\Visiteur::getAuthType() }}">
              <true><input type="submit" class="btn bg-app-yellow text-white mb-3" value="Je m'engage *"></true>
              <false><input type="submit" class="btn bg-app-yellow text-white mb-3" value="Je m'engage"></false>
            </check>
            <input type="hidden" name="file" value="{{ @file }}">
            <input type="hidden" name="md5" value="{{ @md5 }}">
          </form>
          <check if="{{ @auth->getAuthType() === Auth\Type\Visiteur::getAuthType() }}">
            <p class="small text-muted fst-italic opacity-75">* Vous serez redirigé vers une page de connexion si vous n'êtes pas authentifié</p>
          </check>
        </div>
      </div>
    </div>
  </div>
</div>
</false>
<true>
  <div id="resultats-cta" class="container d-print-none">
    <div class="py-4 bg-light">
      <h3 class="display-5 text-center mb-5">Ma formule</h3>
      <div class="d-grid justify-content-center px-3">
        <p class="lead">
          Retrouvez des informations complémentaires sur vos résultats sur la page des formules.
        </p>
        <div class="col-auto text-center">
          <a class="btn bg-app-yellow text-white" href="{{ 'formules', '@file='.@file.',@md5='.@md5 | alias }}">
            Voir ma formule
          </a>
        </div>
      </div>
    </div>
  </div>
</true>
</check>

<div id="retour" class="py-4 d-print-none">
    <div class="text-center">
      <a href="{{ 'logout' | alias }}" title="Retourner à l'accueil" class="btn border me-2" onclick="localStorage.clear();">
        <i class="bi bi-arrow-counterclockwise"></i> Recommencer avec un autre compte
      </a>
    </div>
  </div>
</div>
